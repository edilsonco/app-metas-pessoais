<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Organizador de Metas Pessoais | Defina e Acompanhe Seus Objetivos</title>
    <meta name="description" content="Defina, organize e acompanhe suas metas de curto, médio e longo prazo com nosso aplicativo simples e visual. Transforme seus objetivos em realidade!">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2CLL36GLYW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2CLL36GLYW');
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        /* Custom Styles */
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        body.overflow-hidden { overflow: hidden; }
        .transition-all { transition: all 0.3s ease-in-out; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-active { background-color: #e0f2fe; color: #0c4a6e; font-weight: 600; }
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .modal:not(.flex) { display: none; }
        .modal-content { background-color: #fff; margin: auto; padding: 1.5rem; border-radius: 0.5rem; width: 95%; max-width: 600px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); position: relative; }
        .modal-close { cursor: pointer; position: absolute; top: 0.75rem; right: 0.75rem; font-size: 1.5rem; color: #9ca3af; line-height: 1; }
        .modal-close:hover { color: #374151; }
        .progress-bar-container { background-color: #e5e7eb; border-radius: 9999px; overflow: hidden; height: 0.75rem; }
        .progress-bar { background-color: #3b82f6; height: 100%; text-align: center; color: white; font-size: 0.65rem; line-height: 0.75rem; border-radius: 9999px; transition: width 0.5s ease-in-out; }
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem; padding: 0.5rem; background-color: #fff; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .calendar-header { text-align: center; font-weight: 600; color: #4b5563; padding-bottom: 0.5rem; font-size: 0.75rem; }
        .calendar-day { border: 1px solid #e5e7eb; padding: 0.25rem; text-align: center; min-height: 60px; position: relative; font-size: 0.75rem; background-color: #f9fafb; border-radius: 0.25rem; display: flex; flex-direction: column; justify-content: flex-start; }
        .calendar-day.other-month { color: #d1d5db; background-color: #f3f4f6; }
        .calendar-day .day-number { font-weight: 500; margin-bottom: 0.1rem; color: #374151; font-size: 0.7rem; }
        .calendar-event { font-size: 0.6rem; padding: 0.1rem 0.2rem; border-radius: 0.25rem; margin-top: 0.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: default; }
        .event-milestone { background-color: #bfdbfe; color: #1e40af; }
        .event-deadline { background-color: #fecaca; color: #991b1b; }
        .event-overdue { background-color: #fed7aa; color: #9a3412; }
        .today { background-color: #dbeafe; border: 1px solid #93c5fd; }
        .today .day-number { font-weight: 700; color: #1d4ed8; }
        #mobile-nav-menu { transition: transform 0.3s ease-in-out; }
        #mobile-nav-menu.hidden { transform: translateX(-100%); }
        #mobile-nav-menu:not(.hidden) { transform: translateX(0); }
        #mobile-nav-overlay { transition: opacity 0.3s ease-in-out; }

        @media (min-width: 640px) { /* sm breakpoint */
             .calendar { gap: 0.5rem; padding: 1rem; }
             .calendar-day { padding: 0.5rem; min-height: 80px; font-size: 0.875rem; }
             .calendar-day .day-number { font-size: 0.875rem; margin-bottom: 0.25rem; }
             .calendar-event { font-size: 0.7rem; padding: 0.1rem 0.3rem; margin-top: 0.2rem; }
             .modal-content { padding: 2rem; }
        }
        @media (min-width: 768px) { /* md breakpoint */
             body.overflow-hidden { overflow: auto; }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="flex flex-col md:flex-row h-screen relative">

    <aside class="w-full md:w-64 bg-white shadow-md flex-col hidden md:flex">
        <div class="p-4 md:p-6 text-xl md:text-2xl font-bold text-sky-700 border-b"><i class="fas fa-bullseye mr-2"></i> MetaApp</div>
        <nav class="flex-1 p-2 md:p-4 space-y-1 md:space-y-2">
            <a href="#landing" class="nav-item flex items-center px-3 py-1.5 md:px-4 md:py-2 rounded-md text-gray-700 hover:bg-gray-100 nav-active" data-section="landing"><i class="fas fa-home mr-2 md:mr-3 w-5 text-center"></i> <span class="text-sm md:text-base">Início</span></a>
            <a href="#goals" class="nav-item flex items-center px-3 py-1.5 md:px-4 md:py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="goals"><i class="fas fa-list-check mr-2 md:mr-3 w-5 text-center"></i> <span class="text-sm md:text-base">Minhas Metas</span></a>
            <a href="#dashboard" class="nav-item flex items-center px-3 py-1.5 md:px-4 md:py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="dashboard"><i class="fas fa-chart-line mr-2 md:mr-3 w-5 text-center"></i> <span class="text-sm md:text-base">Painel</span></a>
            <a href="#calendar" class="nav-item flex items-center px-3 py-1.5 md:px-4 md:py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="calendar"><i class="fas fa-calendar-alt mr-2 md:mr-3 w-5 text-center"></i> <span class="text-sm md:text-base">Calendário</span></a>
            <a href="#add-goal" class="nav-item flex items-center px-3 py-1.5 md:px-4 md:py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="add-goal"><i class="fas fa-plus-circle mr-2 md:mr-3 w-5 text-center"></i> <span class="text-sm md:text-base">Nova Meta</span></a>
        </nav>
        <div class="p-2 md:p-4 border-t text-center text-xs text-gray-500">Organizador de Metas v1.5</div> </aside>

    <header class="md:hidden w-full bg-white shadow-md p-3 flex justify-between items-center sticky top-0 z-30">
         <div class="text-lg font-bold text-sky-700"><i class="fas fa-bullseye mr-2"></i> MetaApp</div>
         <button id="mobile-menu-btn" class="text-gray-600 p-1"><i class="fas fa-bars text-xl"></i></button>
    </header>

    <main class="flex-1 bg-gray-100 overflow-y-auto p-4 md:p-8 w-full">

        <section id="landing" class="content-section text-center">
             <div class="bg-white p-6 md:p-12 rounded-lg shadow-lg max-w-3xl mx-auto">
                 <h1 class="text-3xl md:text-4xl font-bold text-sky-800 mb-3 md:mb-4">Organizador de Metas Pessoais</h1>
                <p class="text-lg md:text-xl text-gray-600 mb-6 md:mb-8">Transforme seus objetivos em conquistas reais.</p>
                <button id="start-now-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2.5 px-6 md:py-3 md:px-8 rounded-lg text-base md:text-lg transition-all">Começar Agora <i class="fas fa-arrow-right ml-2"></i></button>
                <div class="mt-8 md:mt-10 text-left text-gray-700 space-y-3 md:space-y-4 text-sm md:text-base">
                     <h2 class="text-xl md:text-2xl font-semibold text-sky-700 mb-2 md:mb-3">Como funciona:</h2>
                     <p><i class="fas fa-check-circle text-green-500 mr-2"></i> Defina suas metas com clareza.</p>
                     <p><i class="fas fa-check-circle text-green-500 mr-2"></i> Organize-as por categorias e prioridades.</p>
                     <p><i class="fas fa-check-circle text-green-500 mr-2"></i> Crie marcos para acompanhar seu progresso.</p>
                     <p><i class="fas fa-check-circle text-green-500 mr-2"></i> Visualize seu avanço no painel e calendário.</p>
                     </div>
            </div>
        </section>

        <section id="add-goal" class="content-section hidden">
             <div class="bg-white p-4 md:p-8 rounded-lg shadow-lg max-w-3xl mx-auto">
                <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-4 md:mb-6">Criar Nova Meta</h2>
                <form id="goal-form">
                    <input type="hidden" id="goal-id">
                    <div class="mb-4"> <label for="goal-title" class="block text-sm md:text-base text-gray-700 font-medium mb-1 md:mb-2">Título da Meta</label> <input type="text" id="goal-title" name="title" class="w-full px-3 py-1.5 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm md:text-base" required> </div>
                    <div class="mb-4"> <label for="goal-description" class="block text-sm md:text-base text-gray-700 font-medium mb-1 md:mb-2">Descrição</label> <textarea id="goal-description" name="description" rows="3" class="w-full px-3 py-1.5 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm md:text-base"></textarea> </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"> <div> <label for="goal-category" class="block text-sm md:text-base text-gray-700 font-medium mb-1 md:mb-2">Categoria</label> <select id="goal-category" name="category" class="w-full px-3 py-1.5 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 bg-white text-sm md:text-base"><option value="Saúde">Saúde</option><option value="Carreira">Carreira</option><option value="Finanças">Finanças</option><option value="Educação">Educação</option><option value="Pessoal">Pessoal</option><option value="Outro">Outro</option></select> </div> <div> <label for="goal-priority" class="block text-sm md:text-base text-gray-700 font-medium mb-1 md:mb-2">Prioridade</label> <select id="goal-priority" name="priority" class="w-full px-3 py-1.5 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 bg-white text-sm md:text-base"><option value="Alta">Alta</option><option value="Média">Média</option><option value="Baixa">Baixa</option></select> </div> </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"> <div> <label for="goal-start-date" class="block text-sm md:text-base text-gray-700 font-medium mb-1 md:mb-2">Data de Início</label> <input type="date" id="goal-start-date" name="startDate" class="w-full px-3 py-1.5 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm md:text-base" required> </div> <div> <label for="goal-end-date" class="block text-sm md:text-base text-gray-700 font-medium mb-1 md:mb-2">Data Final</label> <input type="date" id="goal-end-date" name="endDate" class="w-full px-3 py-1.5 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm md:text-base" required> </div> </div>
                    <div class="mb-4 md:mb-6"> <label class="block text-sm md:text-base text-gray-700 font-medium mb-1 md:mb-2">Marcos Intermediários</label> <div id="milestones-container" class="space-y-2 md:space-y-3"></div> <button type="button" id="add-milestone-btn" class="mt-2 md:mt-3 text-sm text-sky-600 hover:text-sky-800 font-medium"><i class="fas fa-plus-circle mr-1"></i> Adicionar Marco</button> </div>
                    <div class="flex flex-col-reverse md:flex-row justify-end space-y-2 space-y-reverse md:space-y-0 md:space-x-3 mt-4"> <button type="button" id="cancel-edit-btn" class="w-full md:w-auto bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-5 rounded-lg transition-all hidden text-sm md:text-base">Cancelar Edição</button> <button type="submit" class="w-full md:w-auto bg-sky-600 hover:bg-sky-700 text-white font-medium py-2 px-5 rounded-lg transition-all text-sm md:text-base"><span id="submit-btn-text">Salvar Meta</span> <i class="fas fa-save ml-1"></i></button> </div>
                </form>
            </div>
        </section>

        <section id="goals" class="content-section hidden">
             <div class="bg-white p-3 md:p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-4 md:mb-6">Minhas Metas</h2>
                <div class="flex flex-wrap gap-3 md:gap-4 mb-4 md:mb-6 p-3 md:p-4 bg-gray-50 rounded-md border"> <div class="flex-grow min-w-[120px]"> <label for="filter-category" class="text-xs md:text-sm font-medium text-gray-600 block mb-1">Categoria:</label> <select id="filter-category" class="w-full px-2 py-1 md:px-3 md:py-1.5 border border-gray-300 rounded-md text-xs md:text-sm focus:outline-none focus:ring-1 focus:ring-sky-500 bg-white"><option value="Todos">Todos</option><option value="Saúde">Saúde</option><option value="Carreira">Carreira</option><option value="Finanças">Finanças</option><option value="Educação">Educação</option><option value="Pessoal">Pessoal</option><option value="Outro">Outro</option></select> </div> <div class="flex-grow min-w-[120px]"> <label for="filter-status" class="text-xs md:text-sm font-medium text-gray-600 block mb-1">Status:</label> <select id="filter-status" class="w-full px-2 py-1 md:px-3 md:py-1.5 border border-gray-300 rounded-md text-xs md:text-sm focus:outline-none focus:ring-1 focus:ring-sky-500 bg-white"><option value="Todos">Todos</option><option value="Em andamento">Em andamento</option><option value="Concluída">Concluída</option><option value="Atrasada">Atrasada</option></select> </div> <div class="flex-grow min-w-[120px]"> <label for="filter-priority" class="text-xs md:text-sm font-medium text-gray-600 block mb-1">Prioridade:</label> <select id="filter-priority" class="w-full px-2 py-1 md:px-3 md:py-1.5 border border-gray-300 rounded-md text-xs md:text-sm focus:outline-none focus:ring-1 focus:ring-sky-500 bg-white"><option value="Todos">Todos</option><option value="Alta">Alta</option><option value="Média">Média</option><option value="Baixa">Baixa</option></select> </div> <div class="flex items-end"> <button id="clear-filters-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium py-1 px-3 md:py-1.5 md:px-4 rounded-md text-xs md:text-sm transition-all">Limpar</button> </div> </div>
                <div id="goal-list-container" class="space-y-3 md:space-y-4"> <p id="no-goals-message" class="text-center text-gray-500 py-6 md:py-8 text-sm md:text-base">Nenhuma meta cadastrada ainda. <a href="#add-goal" class="text-sky-600 hover:underline" onclick="showSection('add-goal'); return false;">Crie sua primeira meta!</a></p> </div>
            </div>
        </section>

        <section id="dashboard" class="content-section hidden">
             <div class="bg-white p-3 md:p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-4 md:mb-6">Painel de Progresso</h2>
                <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8"> <div class="bg-blue-100 p-3 md:p-4 rounded-lg shadow text-center"><h3 class="text-sm md:text-lg font-semibold text-blue-800">Ativas</h3><p id="active-goals-count" class="text-2xl md:text-3xl font-bold text-blue-600">0</p></div> <div class="bg-green-100 p-3 md:p-4 rounded-lg shadow text-center"><h3 class="text-sm md:text-lg font-semibold text-green-800">Concluídas</h3><p id="completed-goals-count" class="text-2xl md:text-3xl font-bold text-green-600">0</p></div> <div class="bg-red-100 p-3 md:p-4 rounded-lg shadow text-center"><h3 class="text-sm md:text-lg font-semibold text-red-800">Atrasadas</h3><p id="overdue-goals-count" class="text-2xl md:text-3xl font-bold text-red-600">0</p></div> <div class="bg-yellow-100 p-3 md:p-4 rounded-lg shadow text-center"><h3 class="text-sm md:text-lg font-semibold text-yellow-800">Prazos Próx.</h3><p id="upcoming-deadlines-count" class="text-2xl md:text-3xl font-bold text-yellow-600">0</p><span class="text-xs text-yellow-700 block">(7 dias)</span></div> </div>
                <div class="mb-6 md:mb-8"> <h3 class="text-lg md:text-xl font-semibold text-gray-700 mb-3 md:mb-4">Progresso Geral</h3> <div class="bg-gray-50 p-2 md:p-4 rounded-lg border h-48 md:h-64"><canvas id="overallProgressChart"></canvas></div> </div>
                <div> <h3 class="text-lg md:text-xl font-semibold text-gray-700 mb-3 md:mb-4">Prazos e Marcos Próximos</h3> <div id="upcoming-items-list" class="space-y-2 md:space-y-3 bg-gray-50 p-2 md:p-4 rounded-lg border max-h-48 md:max-h-60 overflow-y-auto"> <p id="no-upcoming-message" class="text-center text-gray-500 py-4 text-sm md:text-base">Nenhum prazo ou marco próximo.</p> </div> </div>
            </div>
        </section>

        <section id="calendar" class="content-section hidden">
             <div class="bg-white p-3 md:p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-3 md:mb-4">Calendário Visual</h2>
                <div class="flex justify-between items-center mb-3 md:mb-4"> <button id="prev-month-btn" class="px-2 py-0.5 md:px-3 md:py-1 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-700"><i class="fas fa-chevron-left"></i></button> <h3 id="calendar-month-year" class="text-base md:text-xl font-semibold text-sky-700 text-center mx-2"></h3> <button id="next-month-btn" class="px-2 py-0.5 md:px-3 md:py-1 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-700"><i class="fas fa-chevron-right"></i></button> </div>
                <div class="calendar-header-row grid grid-cols-7 gap-1 md:gap-2 mb-1 md:mb-2 text-center font-medium text-xs md:text-sm text-gray-500"> <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div> </div>
                <div id="calendar-grid" class="calendar"> </div>
                <div class="mt-3 md:mt-4 flex flex-wrap gap-x-3 md:gap-x-4 gap-y-1 md:gap-y-2 text-xs"> <span class="flex items-center"><span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-[#bfdbfe] mr-1 md:mr-1.5"></span> Marco</span> <span class="flex items-center"><span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-[#fecaca] mr-1 md:mr-1.5"></span> Prazo</span> <span class="flex items-center"><span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-[#fed7aa] mr-1 md:mr-1.5"></span> Atrasado</span> </div>
            </div>
        </section>

        <section id="reminders" class="content-section hidden"> <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg max-w-2xl mx-auto text-center"> <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-4 md:mb-6">Lembretes e Notificações</h2> <p class="text-gray-600 mb-4 text-sm md:text-base">Esta funcionalidade ainda está em desenvolvimento.</p> <p class="text-gray-500 text-xs md:text-sm">No futuro, você poderá configurar lembretes automáticos.</p> <i class="fas fa-bell text-4xl md:text-5xl text-yellow-400 mt-4 md:mt-6"></i> </div> </section>

        <section id="export" class="content-section hidden"> <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg max-w-2xl mx-auto text-center"> <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-4 md:mb-6">Exportar e Compartilhar</h2> <p class="text-gray-600 mb-4 md:mb-6 text-sm md:text-base">Funcionalidades básicas:</p> <div class="space-y-3 md:space-y-0 md:space-x-4 flex flex-col md:flex-row justify-center"> <button onclick="alert('Funcionalidade de exportar para PDF ainda não implementada.')" class="w-full md:w-auto bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-5 rounded-lg transition-all text-sm md:text-base"><i class="fas fa-file-pdf mr-2"></i> Exportar PDF (Simples)</button> <button onclick="alert('Funcionalidade de compartilhar link ainda não implementada.')" class="w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-5 rounded-lg transition-all text-sm md:text-base"><i class="fas fa-share-alt mr-2"></i> Compartilhar Link (Simples)</button> </div> <p class="text-gray-500 text-xs md:text-sm mt-6 md:mt-8">Versões futuras incluirão opções mais avançadas.</p> </div> </section>

        <div id="confirmation-modal" class="modal items-center justify-center"> <div class="modal-content max-w-sm"> <span class="modal-close" onclick="closeModal('confirmation-modal')">&times;</span> <h3 class="text-lg font-semibold mb-4" id="modal-title">Confirmar Ação</h3> <p id="modal-message" class="text-gray-600 mb-6 text-sm md:text-base">Você tem certeza?</p> <div class="flex flex-col-reverse md:flex-row justify-end space-y-2 space-y-reverse md:space-y-0 md:space-x-3"> <button id="modal-cancel-btn" class="w-full md:w-auto bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-4 rounded-lg text-sm md:text-base" onclick="closeModal('confirmation-modal')">Cancelar</button> <button id="modal-confirm-btn" class="w-full md:w-auto bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg text-sm md:text-base">Confirmar</button> </div> </div> </div>

        <div id="mobile-nav-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity duration-300 ease-in-out" onclick="toggleMobileMenu(false)"></div>
         <div id="mobile-nav-menu" class="hidden fixed top-0 left-0 h-full w-64 bg-white shadow-xl z-50 p-4 transform -translate-x-full transition-transform duration-300 ease-in-out"> <button class="absolute top-3 right-3 text-gray-500 p-1" onclick="toggleMobileMenu(false)"><i class="fas fa-times text-xl"></i></button> <div class="text-lg font-bold text-sky-700 mb-6 mt-2">Menu</div> <nav class="flex flex-col space-y-2"> <a href="#landing" class="mobile-nav-item block px-4 py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="landing"><i class="fas fa-home w-5 mr-2 text-center"></i>Início</a> <a href="#goals" class="mobile-nav-item block px-4 py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="goals"><i class="fas fa-list-check w-5 mr-2 text-center"></i>Minhas Metas</a> <a href="#dashboard" class="mobile-nav-item block px-4 py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="dashboard"><i class="fas fa-chart-line w-5 mr-2 text-center"></i>Painel</a> <a href="#calendar" class="mobile-nav-item block px-4 py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="calendar"><i class="fas fa-calendar-alt w-5 mr-2 text-center"></i>Calendário</a> <a href="#add-goal" class="mobile-nav-item block px-4 py-2 rounded-md text-gray-700 hover:bg-gray-100" data-section="add-goal"><i class="fas fa-plus-circle w-5 mr-2 text-center"></i>Nova Meta</a> </nav> </div>

    </main>

    <script>
        // --- Application State ---
        let goals = []; // Initialize empty, load in DOMContentLoaded
        let currentEditingGoalId = null;
        let currentCalendarDate = new Date();
        let overallProgressChartInstance = null;

        // --- DOM Elements (Selected in DOMContentLoaded) ---
        let sections, navItems, mobileNavItems, startNowButton, goalForm, goalListContainer, noGoalsMessage, milestonesContainer, addMilestoneBtn, goalIdInput, submitBtnText, cancelEditBtn, filterCategory, filterStatus, filterPriority, clearFiltersBtn, activeGoalsCountEl, completedGoalsCountEl, overdueGoalsCountEl, upcomingDeadlinesCountEl, overallProgressChartCtx = null, upcomingItemsListEl, noUpcomingMessage, calendarGrid, calendarMonthYear, prevMonthBtn, nextMonthBtn, confirmationModal, modalTitle, modalMessage, modalConfirmBtn, mobileMenuBtn, mobileNavMenu, mobileNavOverlay;

        // --- Utility Functions ---
        const showSection = (sectionId, fromMobile = false) => {
            if (!sections) return;
            sections.forEach(section => section.classList.add('hidden'));
            const activeSection = document.getElementById(sectionId);
            if (activeSection) activeSection.classList.remove('hidden');
            navItems?.forEach(item => { item.classList.remove('nav-active'); if (item.dataset.section === sectionId) item.classList.add('nav-active'); });
            mobileNavItems?.forEach(item => { item.classList.remove('bg-gray-200'); if (item.dataset.section === sectionId) item.classList.add('bg-gray-200'); });
            if (sectionId === 'goals') renderGoalList();
            if (sectionId === 'dashboard') renderDashboard();
            if (sectionId === 'calendar') renderCalendar();
            if (sectionId === 'add-goal' && !currentEditingGoalId) resetGoalForm();
            if (fromMobile) toggleMobileMenu(false);
            document.querySelector('main')?.scrollTop = 0;
        };

        const saveGoals = () => {
            try { localStorage.setItem('goals', JSON.stringify(goals)); } catch (e) { console.error("Error saving goals to localStorage:", e); }
        };

        const getGoalStatus = (goal) => { /* ... see previous version ... */
            if (!goal) return 'Desconhecido'; const today = new Date().setHours(0, 0, 0, 0); const endDateStr = goal.endDate; if (!endDateStr) return goal.completed ? 'Concluída' : 'Em andamento'; try { const parts = endDateStr.split('-'); if (parts.length !== 3) return 'Em andamento'; const endDate = new Date(parts[0], parseInt(parts[1]) - 1, parseInt(parts[2])).setHours(0,0,0,0); if (isNaN(endDate)) return 'Em andamento'; if (goal.completed) return 'Concluída'; if (endDate < today) return 'Atrasada'; return 'Em andamento'; } catch (e) { console.error("Error parsing end date:", endDateStr, e); return 'Em andamento'; }
         };
        const calculateGoalProgress = (goal) => { /* ... see previous version ... */
            if (!goal) return 0; if (goal.completed) return 100; if (!Array.isArray(goal.milestones) || goal.milestones.length === 0) return 0; const completedMilestones = goal.milestones.filter(m => m?.completed).length; return Math.round((completedMilestones / goal.milestones.length) * 100);
         };
        const formatDate = (dateString) => { /* ... see previous version ... */
            if (!dateString || typeof dateString !== 'string' || dateString.length < 10) return 'N/A'; try { const parts = dateString.split('-'); if (parts.length !== 3) return 'Data Inválida'; const year = parseInt(parts[0]); const month = parseInt(parts[1]) - 1; const day = parseInt(parts[2]); if (isNaN(year) || isNaN(month) || isNaN(day)) return 'Data Inválida'; const date = new Date(Date.UTC(year, month, day)); if (isNaN(date.getTime())) return 'Data Inválida'; return date.toLocaleDateString('pt-BR', { timeZone: 'UTC' }); } catch (e) { console.error("Error formatting date:", dateString, e); return 'Data Inválida'; }
         };
        const getPriorityClass = (priority) => { switch(priority){case 'Alta': return 'border-red-500'; case 'Média': return 'border-yellow-500'; case 'Baixa': return 'border-green-500'; default: return 'border-gray-300';} };
        const getStatusBadgeClass = (status) => { switch(status){case 'Concluída': return 'bg-green-100 text-green-800'; case 'Atrasada': return 'bg-red-100 text-red-800'; case 'Em andamento': return 'bg-blue-100 text-blue-800'; default: return 'bg-gray-100 text-gray-800';} };

        // --- Milestone Management ---
        const addMilestoneInput = (milestone = { text: '', date: '', completed: false }) => {
             if (!milestonesContainer) return; const div = document.createElement('div'); div.className = 'flex flex-col sm:flex-row items-start sm:items-center space-y-1 sm:space-y-0 sm:space-x-2 milestone-entry'; const safeText = milestone?.text || ''; const safeDate = milestone?.date || ''; const safeCompleted = milestone?.completed || false; div.innerHTML = `<div class="flex items-center w-full sm:w-auto"><input type="checkbox" class="milestone-completed h-4 w-4 text-sky-600 border-gray-300 rounded focus:ring-sky-500 mr-2" ${safeCompleted ? 'checked' : ''}><input type="text" placeholder="Descrição do Marco" value="${safeText.replace(/"/g, '&quot;')}" class="milestone-text flex-grow px-2 py-1 md:px-3 md:py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-sky-500" required></div><div class="flex items-center w-full sm:w-auto space-x-2"><input type="date" value="${safeDate}" class="milestone-date px-2 py-1 md:px-3 md:py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-sky-500 w-full sm:w-auto"><button type="button" class="remove-milestone-btn text-red-500 hover:text-red-700 text-sm p-1" title="Remover Marco"><i class="fas fa-times-circle"></i></button></div>`; milestonesContainer.appendChild(div); div.querySelector('.remove-milestone-btn')?.addEventListener('click', () => div.remove());
        };
        // Note: addMilestoneBtn listener added in DOMContentLoaded

        // --- Goal Form Handling ---
        const resetGoalForm = () => {
            if (!goalForm || !milestonesContainer || !goalIdInput || !submitBtnText || !cancelEditBtn) return; goalForm.reset(); milestonesContainer.innerHTML = ''; goalIdInput.value = ''; currentEditingGoalId = null; submitBtnText.textContent = 'Salvar Meta'; cancelEditBtn.classList.add('hidden'); addMilestoneInput();
        };
        // Note: goalForm listener added in DOMContentLoaded
        // Note: cancelEditBtn listener added in DOMContentLoaded

        // --- Goal List Rendering and Filtering ---
        const renderGoalList = () => {
            if (!goalListContainer || !filterCategory || !filterStatus || !filterPriority || !noGoalsMessage) return; goalListContainer.innerHTML = ''; const categoryFilter = filterCategory.value; const statusFilter = filterStatus.value; const priorityFilter = filterPriority.value; const filteredGoals = goals.filter(goal => { if (!goal) return false; const status = getGoalStatus(goal); const categoryMatch = categoryFilter === 'Todos' || goal.category === categoryFilter; const statusMatch = statusFilter === 'Todos' || status === statusFilter; const priorityMatch = priorityFilter === 'Todos' || goal.priority === priorityFilter; return categoryMatch && statusMatch && priorityMatch; }); if (filteredGoals.length === 0) { noGoalsMessage.classList.toggle('hidden', goals.length === 0); goalListContainer.innerHTML = goals.length > 0 ? '<p class="text-center text-gray-500 py-8 text-sm md:text-base">Nenhuma meta encontrada com os filtros selecionados.</p>' : ''; } else { noGoalsMessage.classList.add('hidden'); filteredGoals.sort((a, b) => { try { return new Date(b.startDate) - new Date(a.startDate); } catch { return 0; } }); filteredGoals.forEach(goal => goal && goalListContainer.appendChild(createGoalCard(goal))); }
        };
        const createGoalCard = (goal) => { /* ... see previous version ... */
            if (!goal) return document.createDocumentFragment(); const card = document.createElement('div'); const status = getGoalStatus(goal); const progress = calculateGoalProgress(goal); const priorityClass = getPriorityClass(goal.priority); const statusBadgeClass = getStatusBadgeClass(status); card.className = `bg-white p-3 md:p-5 rounded-lg shadow border-l-4 ${priorityClass} mb-3 md:mb-4 transition-all hover:shadow-md`; const goalTitle = goal.title || 'Meta sem título'; const goalCategory = goal.category || 'N/A'; const goalPriority = goal.priority || 'N/A'; const goalDesc = goal.description || 'Sem descrição.'; const milestones = Array.isArray(goal.milestones) ? goal.milestones : []; const completedMilestoneCount = milestones.filter(m => m?.completed).length; const totalMilestoneCount = milestones.length; card.innerHTML = `<div class="flex justify-between items-start mb-2"><div><h3 class="text-base md:text-xl font-semibold text-gray-800 break-words">${goalTitle.replace(/</g, "&lt;")}</h3><span class="text-xs font-medium px-1.5 py-0.5 rounded ${statusBadgeClass}">${status}</span><span class="text-xs md:text-sm text-gray-500 ml-1 md:ml-2">(${goalCategory.replace(/</g, "&lt;")} / ${goalPriority.replace(/</g, "&lt;")})</span></div><div class="flex space-x-1 md:space-x-2 text-gray-500 text-sm md:text-base flex-shrink-0">${!goal.completed ? `<button class="complete-btn hover:text-green-600 p-1" title="Marcar como Concluída" data-id="${goal.id}"><i class="fas fa-check-circle"></i></button>` : `<button class="uncomplete-btn hover:text-yellow-600 p-1" title="Marcar como Em Andamento" data-id="${goal.id}"><i class="fas fa-undo"></i></button>`}<button class="edit-btn hover:text-sky-600 p-1" title="Editar Meta" data-id="${goal.id}"><i class="fas fa-edit"></i></button><button class="delete-btn hover:text-red-600 p-1" title="Excluir Meta" data-id="${goal.id}"><i class="fas fa-trash-alt"></i></button></div></div><p class="text-gray-600 text-xs md:text-sm mb-2 break-words">${goalDesc.replace(/</g, "&lt;")}</p><div class="text-xs md:text-sm text-gray-500 mb-2"><span>Início: ${formatDate(goal.startDate)}</span> | <span>Final: ${formatDate(goal.endDate)}</span></div><div class="mb-2"><div class="flex justify-between text-xs text-gray-600 mb-1"><span>Progresso (${progress}%)</span><span>Marcos: ${completedMilestoneCount}/${totalMilestoneCount}</span></div><div class="progress-bar-container"><div class="progress-bar" style="width: ${progress}%;"></div></div></div><details class="text-xs md:text-sm"><summary class="cursor-pointer text-sky-700 hover:underline font-medium">Ver Marcos (${totalMilestoneCount})</summary><ul class="list-disc list-inside mt-1 md:mt-2 space-y-0.5 md:space-y-1 pl-4 text-gray-600">${milestones.length > 0 ? milestones.map(m => `<li class="${m?.completed ? 'line-through text-gray-400' : ''}"><i class="fas ${m?.completed ? 'fa-check-square text-green-500' : 'fa-square text-gray-400'} mr-1 text-xs"></i>${(m?.text || '').replace(/</g, "&lt;")} ${m?.date ? `(${formatDate(m.date)})` : ''}</li>`).join('') : '<li class="text-gray-400 italic">Nenhum marco definido.</li>'}</ul></details>`; card.querySelector('.edit-btn')?.addEventListener('click', (e) => { e.stopPropagation(); editGoal(goal.id); }); card.querySelector('.delete-btn')?.addEventListener('click', (e) => { e.stopPropagation(); confirmDeleteGoal(goal.id); }); card.querySelector('.complete-btn')?.addEventListener('click', (e) => { e.stopPropagation(); toggleGoalCompletion(goal.id, true); }); card.querySelector('.uncomplete-btn')?.addEventListener('click', (e) => { e.stopPropagation(); toggleGoalCompletion(goal.id, false); }); return card;
         };

        // --- Goal Actions (Edit, Delete, Complete) ---
        const editGoal = (id) => { /* ... see previous version ... */ const goal = goals.find(g => g?.id === id); if (!goal || !goalForm || !milestonesContainer || !goalIdInput || !submitBtnText || !cancelEditBtn) return; currentEditingGoalId = id; goalIdInput.value = id; document.getElementById('goal-title').value = goal.title || ''; document.getElementById('goal-description').value = goal.description || ''; document.getElementById('goal-category').value = goal.category || 'Outro'; document.getElementById('goal-priority').value = goal.priority || 'Média'; document.getElementById('goal-start-date').value = goal.startDate || ''; document.getElementById('goal-end-date').value = goal.endDate || ''; milestonesContainer.innerHTML = ''; if (Array.isArray(goal.milestones) && goal.milestones.length > 0) { goal.milestones.forEach(m => addMilestoneInput(m)); } else { addMilestoneInput(); } submitBtnText.textContent = 'Atualizar Meta'; cancelEditBtn.classList.remove('hidden'); showSection('add-goal'); };
        const confirmDeleteGoal = (id) => openModal('confirmation-modal', 'Excluir Meta', 'Tem certeza que deseja excluir esta meta? Esta ação não pode ser desfeita.', () => deleteGoal(id));
        const deleteGoal = (id) => { goals = goals.filter(g => g?.id !== id); saveGoals(); renderGoalList(); renderDashboard(); renderCalendar(); closeModal('confirmation-modal'); };
        const toggleGoalCompletion = (id, completedStatus) => { const index = goals.findIndex(g => g?.id === id); if (index !== -1) { if(goals[index]) { goals[index].completed = completedStatus; if (Array.isArray(goals[index].milestones)) { goals[index].milestones.forEach(m => { if(m) m.completed = completedStatus; }); } saveGoals(); renderGoalList(); renderDashboard(); renderCalendar(); } } };

         // --- Modal Handling ---
        const openModal = (modalId, title, message, onConfirm) => { /* ... see previous version ... */ const modalElement = document.getElementById(modalId); if (!modalElement || !modalTitle || !modalMessage) return; modalTitle.textContent = title; modalMessage.textContent = message; const confirmBtn = modalElement.querySelector('#modal-confirm-btn'); if (!confirmBtn) return; const newConfirmBtn = confirmBtn.cloneNode(true); confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn); newConfirmBtn.onclick = onConfirm; modalElement.style.display = 'flex'; };
        const closeModal = (modalId) => { /* ... see previous version ... */ const modalElement = document.getElementById(modalId); if (!modalElement) return; modalElement.style.display = 'none'; const confirmBtn = modalElement.querySelector('#modal-confirm-btn'); if (confirmBtn) confirmBtn.onclick = null; };
        // Note: Window click listener added in DOMContentLoaded

        // --- Dashboard Rendering ---
        const renderDashboard = () => { /* ... see previous version ... */
            if (!activeGoalsCountEl || !completedGoalsCountEl || !overdueGoalsCountEl || !upcomingDeadlinesCountEl || !upcomingItemsListEl || !noUpcomingMessage || !overallProgressChartCtx) return; let activeCount = 0, completedCount = 0, overdueCount = 0; const today = new Date(); const nextWeek = new Date(); nextWeek.setDate(today.getDate() + 7); today.setHours(0,0,0,0); nextWeek.setHours(0,0,0,0); const upcomingItems = []; goals.forEach(goal => { if (!goal) return; const status = getGoalStatus(goal); if (status === 'Concluída') completedCount++; else if (status === 'Atrasada') { overdueCount++; activeCount++; } else activeCount++; const endDateStr = goal.endDate; if (endDateStr && !goal.completed) { try { const parts = endDateStr.split('-'); const endDate = new Date(parts[0], parseInt(parts[1]) - 1, parseInt(parts[2])).setHours(0,0,0,0); if (!isNaN(endDate) && endDate >= today && endDate <= nextWeek) upcomingItems.push({ type: 'Prazo Final', date: goal.endDate, text: goal.title || '', goalId: goal.id }); } catch(e){console.error("Error parsing end date for dashboard:", e);} } if (Array.isArray(goal.milestones)) { goal.milestones.forEach(milestone => { if (!milestone) return; const milestoneDateStr = milestone.date; if (milestoneDateStr && !milestone.completed && !goal.completed) { try { const parts = milestoneDateStr.split('-'); const milestoneDate = new Date(parts[0], parseInt(parts[1]) - 1, parseInt(parts[2])).setHours(0,0,0,0); if (!isNaN(milestoneDate) && milestoneDate >= today && milestoneDate <= nextWeek) upcomingItems.push({ type: 'Marco', date: milestone.date, text: `${goal.title || ''} - ${milestone.text || ''}`, goalId: goal.id }); } catch(e){console.error("Error parsing milestone date for dashboard:", e);} } }); } }); const upcomingGoalIds = new Set(upcomingItems.map(item => item.goalId)); activeGoalsCountEl.textContent = activeCount; completedGoalsCountEl.textContent = completedCount; overdueGoalsCountEl.textContent = overdueCount; upcomingDeadlinesCountEl.textContent = upcomingGoalIds.size; upcomingItems.sort((a, b) => { try { return new Date(a.date) - new Date(b.date); } catch { return 0; } }); upcomingItemsListEl.innerHTML = ''; noUpcomingMessage.classList.toggle('hidden', upcomingItems.length > 0); if (upcomingItems.length > 0) { upcomingItems.forEach(item => { const li = document.createElement('div'); li.className = `p-1.5 md:p-2 border-b border-gray-200 last:border-b-0 text-xs md:text-sm flex justify-between items-center ${item.type === 'Prazo Final' ? 'bg-red-50' : 'bg-blue-50'}`; li.innerHTML = `<span class="flex-1 mr-2 overflow-hidden text-ellipsis whitespace-nowrap"><i class="fas ${item.type === 'Prazo Final' ? 'fa-flag-checkered text-red-600' : 'fa-calendar-check text-blue-600'} mr-1 md:mr-2"></i>${(item.text || '').replace(/</g, "&lt;")}</span><span class="font-medium text-gray-700 whitespace-nowrap">${formatDate(item.date)}</span>`; upcomingItemsListEl.appendChild(li); }); } const chartData = { labels: ['Em Andamento', 'Concluídas', 'Atrasadas'], datasets: [{ label: 'Status das Metas', data: [Math.max(0, activeCount - overdueCount), completedCount, overdueCount], backgroundColor: ['rgba(59, 130, 246, 0.7)', 'rgba(16, 185, 129, 0.7)', 'rgba(239, 68, 68, 0.7)'], borderWidth: 1 }] }; if (overallProgressChartInstance) overallProgressChartInstance.destroy(); try { overallProgressChartInstance = new Chart(overallProgressChartCtx, { type: 'bar', data: chartData, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0 } } }, plugins: { legend: { display: false } } } }); } catch(e){console.error("Error creating chart:", e);}
         };

         // --- Calendar Rendering ---
        const renderCalendar = () => {
             if (!calendarGrid || !calendarMonthYear) { console.error("Calendar elements not found!"); return; } calendarGrid.innerHTML = ''; try { const month = currentCalendarDate.getMonth(); const year = currentCalendarDate.getFullYear(); calendarMonthYear.textContent = `${currentCalendarDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}`; const firstDayOfMonth = new Date(year, month, 1); const lastDayOfMonth = new Date(year, month + 1, 0); const daysInMonth = lastDayOfMonth.getDate(); const startDayOfWeek = firstDayOfMonth.getDay(); const today = new Date(); today.setHours(0,0,0,0); const events = getEventsForMonth(year, month); const lastDayOfPrevMonth = new Date(year, month, 0).getDate(); for (let i = startDayOfWeek - 1; i >= 0; i--) { calendarGrid.appendChild(createCalendarDayCell(lastDayOfPrevMonth - i, month - 1, year, true)); } for (let day = 1; day <= daysInMonth; day++) { const currentDate = new Date(year, month, day); currentDate.setHours(0,0,0,0); const isToday = currentDate.getTime() === today.getTime(); const dayEvents = events[day] || []; calendarGrid.appendChild(createCalendarDayCell(day, month, year, false, isToday, dayEvents)); } const totalCells = startDayOfWeek + daysInMonth; const remainingCells = (totalCells % 7 === 0) ? 0 : 7 - (totalCells % 7); for (let i = 1; i <= remainingCells; i++) { calendarGrid.appendChild(createCalendarDayCell(i, month + 1, year, true)); } } catch (error) { console.error("Error rendering calendar days:", error); calendarGrid.innerHTML = '<p class="text-red-500 text-center col-span-7 p-4">Erro ao carregar o calendário.</p>'; }
        };
        const createCalendarDayCell = (day, month, year, isOtherMonth, isToday = false, dayEvents = []) => { /* ... see previous version ... */
            const cell = document.createElement('div'); cell.className = 'calendar-day'; if (isOtherMonth) cell.classList.add('other-month'); if (isToday) cell.classList.add('today'); const currentDate = new Date(year, month, day); const displayDay = currentDate.getDate(); cell.innerHTML = `<span class="day-number">${displayDay}</span>`; const eventsToShow = Array.isArray(dayEvents) ? dayEvents : []; if (eventsToShow.length > 0) { const eventsContainer = document.createElement('div'); eventsContainer.className = 'space-y-0.5 overflow-hidden'; eventsToShow.slice(0, 1).forEach(event => { if(!event) return; const eventEl = document.createElement('div'); eventEl.className = `calendar-event ${event.class || ''}`; eventEl.textContent = event.text || ''; eventEl.title = `${event.type || 'Evento'}: ${event.fullText || ''}`; eventsContainer.appendChild(eventEl); }); if (eventsToShow.length > 1) { const moreEl = document.createElement('div'); moreEl.className = 'text-xs text-gray-500 mt-0.5'; moreEl.textContent = `+${eventsToShow.length - 1}`; eventsContainer.appendChild(moreEl); } cell.appendChild(eventsContainer); } return cell;
         };
        const getEventsForMonth = (year, month) => { /* ... see previous version, includes try/catch now ... */
            const events = {}; const today = new Date().setHours(0,0,0,0); try { goals.forEach(goal => { if (!goal || typeof goal !== 'object') return; if (Array.isArray(goal.milestones)) { goal.milestones.forEach(milestone => { try { if (!milestone || !milestone.date) return; const parts = milestone.date.split('-'); if (parts.length !== 3) return; const milestoneDate = new Date(parts[0], parseInt(parts[1]) - 1, parseInt(parts[2])).setHours(0,0,0,0); if (isNaN(milestoneDate)) return; if (new Date(milestoneDate).getFullYear() === year && new Date(milestoneDate).getMonth() === month) { const day = new Date(milestoneDate).getDate(); if (!events[day]) events[day] = []; const isOverdue = milestoneDate < today && !milestone.completed && !goal.completed; const eventClass = milestone.completed || goal.completed ? '' : (isOverdue ? 'event-overdue' : 'event-milestone'); if (eventClass) { events[day].push({ type: 'Marco', text: (milestone.text || '').substring(0, 8) + '...', fullText: milestone.text || '', class: eventClass }); } } } catch (e) { console.error("Error processing milestone:", milestone, e); } }); } try { if (!goal.endDate) return; const parts = goal.endDate.split('-'); if (parts.length !== 3) return; const endDate = new Date(parts[0], parseInt(parts[1]) - 1, parseInt(parts[2])).setHours(0,0,0,0); if (isNaN(endDate)) return; if (new Date(endDate).getFullYear() === year && new Date(endDate).getMonth() === month) { const day = new Date(endDate).getDate(); if (!events[day]) events[day] = []; const goalStatus = getGoalStatus(goal); const eventClass = goalStatus === 'Concluída' ? '' : (goalStatus === 'Atrasada' ? 'event-overdue' : 'event-deadline'); if (eventClass) { events[day].push({ type: 'Prazo', text: (goal.title || '').substring(0, 8) + '...', fullText: goal.title || '', class: eventClass }); } } } catch (e) { console.error("Error processing goal deadline:", goal, e); } }); } catch (error) { console.error("Error processing goals for calendar events:", error); } return events;
         };
        // Note: Calendar button listeners added in DOMContentLoaded

         // --- Mobile Menu Toggle ---
         const toggleMobileMenu = (show) => {
             const body = document.body; if (!mobileNavMenu || !mobileNavOverlay) return; if (show) { mobileNavOverlay.classList.remove('hidden'); mobileNavMenu.classList.remove('hidden'); setTimeout(() => { mobileNavOverlay.classList.remove('opacity-0'); mobileNavMenu.classList.remove('-translate-x-full'); }, 10); body.classList.add('overflow-hidden'); } else { mobileNavOverlay.classList.add('opacity-0'); mobileNavMenu.classList.add('-translate-x-full'); setTimeout(() => { mobileNavOverlay.classList.add('hidden'); mobileNavMenu.classList.add('hidden'); body.classList.remove('overflow-hidden'); }, 300); }
         };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM fully loaded and parsed");
            try {
                // Select DOM elements safely after DOM load
                sections = document.querySelectorAll('.content-section');
                navItems = document.querySelectorAll('.nav-item');
                mobileNavItems = document.querySelectorAll('.mobile-nav-item');
                startNowButton = document.getElementById('start-now-btn');
                goalForm = document.getElementById('goal-form');
                goalListContainer = document.getElementById('goal-list-container');
                noGoalsMessage = document.getElementById('no-goals-message');
                milestonesContainer = document.getElementById('milestones-container');
                addMilestoneBtn = document.getElementById('add-milestone-btn');
                goalIdInput = document.getElementById('goal-id');
                submitBtnText = document.getElementById('submit-btn-text');
                cancelEditBtn = document.getElementById('cancel-edit-btn');
                filterCategory = document.getElementById('filter-category');
                filterStatus = document.getElementById('filter-status');
                filterPriority = document.getElementById('filter-priority');
                clearFiltersBtn = document.getElementById('clear-filters-btn');
                activeGoalsCountEl = document.getElementById('active-goals-count');
                completedGoalsCountEl = document.getElementById('completed-goals-count');
                overdueGoalsCountEl = document.getElementById('overdue-goals-count');
                upcomingDeadlinesCountEl = document.getElementById('upcoming-deadlines-count');
                const chartCanvas = document.getElementById('overallProgressChart'); // Select canvas first
                overallProgressChartCtx = chartCanvas ? chartCanvas.getContext('2d') : null; // Get context safely
                upcomingItemsListEl = document.getElementById('upcoming-items-list');
                noUpcomingMessage = document.getElementById('no-upcoming-message');
                calendarGrid = document.getElementById('calendar-grid');
                calendarMonthYear = document.getElementById('calendar-month-year');
                prevMonthBtn = document.getElementById('prev-month-btn');
                nextMonthBtn = document.getElementById('next-month-btn');
                confirmationModal = document.getElementById('confirmation-modal');
                modalTitle = document.getElementById('modal-title');
                modalMessage = document.getElementById('modal-message');
                modalConfirmBtn = document.getElementById('modal-confirm-btn');
                mobileMenuBtn = document.getElementById('mobile-menu-btn');
                mobileNavMenu = document.getElementById('mobile-nav-menu');
                mobileNavOverlay = document.getElementById('mobile-nav-overlay');

                // Load goals safely
                const storedGoals = localStorage.getItem('goals');
                goals = storedGoals ? JSON.parse(storedGoals) : [];
                if (!Array.isArray(goals)) { console.warn("Stored goals data is not an array, resetting."); goals = []; localStorage.setItem('goals', JSON.stringify(goals)); }
                console.log("Goals loaded:", goals.length);

                // Add Event Listeners Safely
                navItems?.forEach(item => { item.addEventListener('click', (e) => { e.preventDefault(); showSection(item.dataset.section); if (item.dataset.section === 'add-goal' && !currentEditingGoalId) resetGoalForm(); }); });
                mobileMenuBtn?.addEventListener('click', (e) => { e.stopPropagation(); toggleMobileMenu(true); });
                mobileNavItems?.forEach(item => { item.addEventListener('click', (e) => { e.preventDefault(); showSection(item.dataset.section, true); if (item.dataset.section === 'add-goal' && !currentEditingGoalId) resetGoalForm(); }); });
                mobileNavOverlay?.addEventListener('click', () => toggleMobileMenu(false));
                startNowButton?.addEventListener('click', () => showSection('goals'));
                filterCategory?.addEventListener('change', renderGoalList);
                filterStatus?.addEventListener('change', renderGoalList);
                filterPriority?.addEventListener('change', renderGoalList);
                clearFiltersBtn?.addEventListener('click', () => { if(filterCategory && filterStatus && filterPriority){ filterCategory.value = 'Todos'; filterStatus.value = 'Todos'; filterPriority.value = 'Todos'; renderGoalList(); }});
                addMilestoneBtn?.addEventListener('click', () => addMilestoneInput());
                goalForm?.addEventListener('submit', (e) => { /* ... submit logic from previous version ... */
                    e.preventDefault(); try { const formData = new FormData(goalForm); const goalData = Object.fromEntries(formData.entries()); goalData.milestones = []; document.querySelectorAll('.milestone-entry').forEach(entry => { const textInput = entry.querySelector('.milestone-text'); const dateInput = entry.querySelector('.milestone-date'); const completedCheckbox = entry.querySelector('.milestone-completed'); if (textInput && textInput.value.trim()) { goalData.milestones.push({ text: textInput.value.trim(), date: dateInput ? dateInput.value : '', completed: completedCheckbox ? completedCheckbox.checked : false }); } }); if (goalData.endDate && goalData.startDate && goalData.endDate < goalData.startDate) { alert('A Data Final não pode ser anterior à Data de Início.'); return; } if (currentEditingGoalId) { const index = goals.findIndex(g => g.id === currentEditingGoalId); if (index !== -1) { const originalGoal = goals[index]; goals[index] = { ...originalGoal, ...goalData, id: currentEditingGoalId }; const allMilestonesCompleted = goalData.milestones.length > 0 && goalData.milestones.every(m => m.completed); goals[index].completed = allMilestonesCompleted; } } else { goalData.id = `goal-${Date.now()}`; goalData.completed = false; const allMilestonesCompleted = goalData.milestones.length > 0 && goalData.milestones.every(m => m.completed); goalData.completed = allMilestonesCompleted; goals.push(goalData); } saveGoals(); resetGoalForm(); showSection('goals'); } catch (error) { console.error("Error submitting goal form:", error); alert("Ocorreu um erro ao salvar a meta. Tente novamente."); }
                 });
                cancelEditBtn?.addEventListener('click', () => { resetGoalForm(); showSection('goals'); });
                prevMonthBtn?.addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1); renderCalendar(); });
                nextMonthBtn?.addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1); renderCalendar(); });
                window.addEventListener('click', function(event) { if (event.target.classList.contains('modal')) closeModal(event.target.id); }); // Modal backdrop close

                // Initial setup calls
                showSection('landing');
                resetGoalForm();
                renderGoalList();
                renderDashboard();
                renderCalendar();

                // Initial mobile menu state
                if(mobileNavMenu) mobileNavMenu.classList.add('hidden', '-translate-x-full');
                if(mobileNavOverlay) mobileNavOverlay.classList.add('hidden', 'opacity-0');

            } catch (error) {
                console.error("Error during initialization:", error);
                document.body.innerHTML = '<p class="text-red-500 p-4 text-center">Ocorreu um erro crítico ao carregar o aplicativo. Por favor, recarregue a página ou contate o suporte.</p>';
            }
        });

    </script>

</body>
</html>
